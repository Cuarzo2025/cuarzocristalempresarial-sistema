<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuarzo Cristal | Executive Live</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #000000; 
            --card: #0A0A0A; 
            --primary: #FFFFFF; 
            --secondary: #1A1A1A;
            --text-dim: #666666; 
            --border: #222222;
        }

        body { 
            background-color: var(--bg); 
            color: var(--primary); 
            font-family: 'Montserrat', sans-serif; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0; 
        }

        .glass-container { 
            background: var(--card); 
            padding: 60px 40px; 
            border-radius: 2px; 
            width: 90%; 
            max-width: 420px; 
            border: 1px solid var(--border); 
            text-align: center;
            box-shadow: 0 40px 100px rgba(0,0,0,0.9);
        }

        h1 { font-weight: 800; margin: 0 0 10px 0; letter-spacing: 6px; text-transform: uppercase; font-size: 1.2rem; }
        .subtitle { font-size: 0.6rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 4px; margin-bottom: 40px; display: block; }

        .user-info { margin-bottom: 40px; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); padding: 20px 0; }
        .user-label { font-size: 0.55rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 8px; display: block; }
        .user-name { font-weight: 400; font-size: 0.95rem; letter-spacing: 1px; }

        /* BOTÓN PRINCIPAL CON ANIMACIÓN PULSANTE */
        .btn-main { 
            width: 100%; 
            padding: 20px; 
            background: var(--primary); 
            color: var(--bg); 
            border: none; 
            font-weight: 700; 
            cursor: pointer; 
            text-transform: uppercase; 
            font-size: 0.75rem;
            letter-spacing: 2px;
            transition: all 0.4s ease;
            margin-bottom: 15px;
            position: relative;
        }

        /* Animación de titileo suave (Glow Pulse) */
        .btn-main:not(:disabled) {
            animation: pulse-white 2.5s infinite;
        }

        @keyframes pulse-white {
            0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4); }
            50% { box-shadow: 0 0 20px 5px rgba(255, 255, 255, 0.1); }
            100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4); }
        }

        .btn-main:hover:not(:disabled) { 
            background: #e0e0e0;
            letter-spacing: 3px;
            transform: scale(1.01);
        }

        .btn-main:disabled { background: #111; color: #333; cursor: not-allowed; animation: none; }

        .btn-record { 
            width: 100%; 
            padding: 15px; 
            background: transparent; 
            color: var(--primary); 
            border: 1px solid var(--border); 
            font-weight: 400; 
            cursor: pointer; 
            text-transform: uppercase; 
            font-size: 0.65rem;
            letter-spacing: 2px;
        }

        .footer { margin-top: 40px; font-size: 0.5rem; color: #333; letter-spacing: 2px; text-transform: uppercase; }
    </style>
</head>
<body>

    <div class="glass-container">
        <h1>CUARZO CRISTAL</h1>
        <span class="subtitle">Management System</span>

        <div class="user-info">
            <span class="user-label">Authenticated Profile</span>
            <div id="user-display" class="user-name">Sincronizando...</div>
        </div>

        <div class="actions">
            <button id="join-btn" class="btn-main" onclick="joinMeeting()" disabled>Enter Conference</button>
            <button id="record-btn" class="btn-record" onclick="handleRecording()">Record Session</button>
        </div>

        <div class="footer">
            Encrypted Session &bull; 2026 Official Archive
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCW3_c7c4wNs6mUgX0EFp40SnjBx-WfLNI",
            authDomain: "cuarzocristalempresarialsist.firebaseapp.com",
            projectId: "cuarzocristalempresarialsist",
            storageBucket: "cuarzocristalempresarialsist.firebasestorage.app",
            messagingSenderId: "1031610061736",
            appId: "1:1031610061736:web:d05d431b433eb5b55ec39d"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        let finalUserName = "";
        let mediaRecorder;
        let recordedChunks = [];

        onAuthStateChanged(auth, (user) => {
            const display = document.getElementById('user-display');
            const btn = document.getElementById('join-btn');
            if (user) {
                finalUserName = user.displayName || user.email.split('@')[0].toUpperCase();
                display.innerText = finalUserName;
                btn.disabled = false;
            } else {
                window.location.href = "login.html";
            }
        });

        window.joinMeeting = function() {
            const roomName = "Capacitacion_CuarzoCristal_Oficial";
            const config = `#config.prejoinPageEnabled=false&userInfo.displayName="${encodeURIComponent(finalUserName)}"`;
            window.open(`https://meet.jit.si/${roomName}${config}`, '_blank');
        }

        window.handleRecording = async function() {
            const btn = document.getElementById('record-btn');
            if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                alert("iPhone Detectado: Use la función nativa de iOS.");
                return;
            }
            if (!mediaRecorder || mediaRecorder.state === "inactive") {
                try {
                    const stream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    recordedChunks = [];
                    mediaRecorder.ondataavailable = (e) => { if (e.data.size > 0) recordedChunks.push(e.data); };
                    mediaRecorder.onstop = () => {
                        const blob = new Blob(recordedChunks, { type: "video/webm" });
                        const a = document.createElement("a");
                        a.href = URL.createObjectURL(blob);
                        a.download = `CUARZO_RECORDING_${Date.now()}.webm`;
                        a.click();
                        btn.innerText = "Record Session";
                    };
                    mediaRecorder.start();
                    btn.innerText = "Stop & Save";
                } catch (err) { alert("No compatible."); }
            } else {
                mediaRecorder.stop();
                mediaRecorder.stream.getTracks().forEach(t => t.stop());
            }
        }
    </script>
</body>
</html>